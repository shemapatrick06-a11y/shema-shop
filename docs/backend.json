{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for sale in the online store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "stockQuantity": {
          "type": "number",
          "description": "Number of units currently in stock."
        },
        "category": {
          "type": "string",
          "description": "Category the product belongs to."
        },
        "size": {
          "type": "string",
          "description": "Available sizes for the product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "stockQuantity",
        "category"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "shippingAddress": {
          "type": "string",
          "description": "Shipping address for the order."
        },
        "orderStatus": {
          "type": "string",
          "description": "Current status of the order (e.g., pending, processing, shipped, delivered)."
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "shippingAddress",
        "orderStatus"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "unitPrice": {
          "type": "number",
          "description": "Price of a single unit of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "unitPrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of the online store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "shippingAddresses": {
          "type": "array",
          "description": "An array of shipping addresses associated with the customer.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a customer review of a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Review)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the customer (e.g., 1-5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Text of the review comment."
        },
        "reviewDate": {
          "type": "string",
          "description": "Date the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "customerId",
        "rating",
        "comment",
        "reviewDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.  Admin role is required to create/update/delete products.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information. Customers can only access their own data.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for each customer.  Customers can only access their own orders.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual order items for each order. Customers can only access order items within their orders.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores customer reviews for each product. Includes denormalized productCategory for simplified listing and filtering.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "reviewId",
              "description": "Unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Determines admin role by document existence. Only the presence of a document is significant, content is ignored.",
          "params": [
            {
              "name": "userId",
              "description": "User ID to check for admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support an online clothing shop (TrendyThreads) with features like product browsing, detailed product views, shopping cart, checkout, admin dashboard, and a recommendation engine. It prioritizes Authorization Independence through denormalization where applicable, structural segregation for simplified security rules, and access modeling using hierarchical paths for user-owned data and membership maps for collaborative access. The structure explicitly supports listing operations (QAPs) through structural segregation.  Specifically, product reviews are denormalized to include the product category, so listing reviews can be filtered by product category without requiring a collection group query. The admin role is modeled using existence checks in a dedicated collection.\n\n**Authorization Independence (CRITICAL):** Authorization relies solely on `request.auth.uid` and data stored in the documents themselves (or existence checks in dedicated role collections), eliminating `get()` calls in security rules.  For collaborative data (none in this model, but if added, membership maps would be used and denormalized).\n\n**DBAC (No Custom Claims):** Roles are determined by the existence of a document in `/roles_admin/{uid}`.\n\n**QAPs (Rules are not Filters):** Segregation of product data by requiring an admin role to modify products ensures that listing products doesn't require filtering on the client side based on access control.\n\n**Invariants:** Ownership of reviews is maintained through the `customerId` field, and the integrity of this ownership is enforced via security rules."
  }
}